import os

import pydf2json

dir_name = '[TBD]'
for subdir, dirs, files in os.walk(dir_name):
    links = []
    for file in files:
        filepath = os.path.join(subdir, file)
        with open(filepath, 'rb') as pdf:
            pdf_obj = pydf2json.PyDF2JSON()
            try:
                pdf_json_tuple = pdf_obj.GetPDF(pdf.read())
                pdf_json = pdf_json_tuple[2].get("Link Annotations")
                if isinstance(pdf_json, dict):
                    for id, data in pdf_json.items():
                        for link_data in data:
                            if isinstance(link_data, dict):
                                links.append(link_data.get('Link'))
                            else:
                                raise Exception("No link field found")
                else:
                    raise Exception("No link field found")
            except Exception as e:
                print("{}: {}".format(file, e.message))
    links.sort()
    print(os.linesep.join(map(str, links)))
